# 광고 기여도 분석 사용 가이드

## 📋 개요

메타 광고의 다중 접점 기여도를 분석하여 각 광고의 실제 ROAS를 계산하는 기능입니다.

### 문제점
- GA4는 마지막 클릭에만 100% 기여도를 부여
- A → B → C 광고를 거쳐 구매한 경우, C에만 매출이 귀속
- 초기/중간 광고의 기여도가 무시됨

### 해결 방법
- **Time Decay 모델**: 시간 가중 기여도 분배
- 구매에 가까운 광고에 높은 가중치, 초기 광고에도 적절한 가중치
- 3일 반감기: 3일이 지나면 기여도가 절반으로 감소

---

## 🚀 시작하기

### 1. DB 마이그레이션

```bash
# PostgreSQL에 ad_spend 테이블 생성
cd moadamda-analytics/backend
psql -U moadamda -d analytics -f migrations/create_ad_spend.sql
```

### 2. 백엔드 시작

```bash
cd moadamda-analytics/backend
npm start
```

### 3. 프론트엔드 시작

```bash
cd moadamda-analytics/frontend

# 패키지 설치 (최초 1회)
npm install

# 개발 서버 시작
npm run dev
```

### 4. 접속

브라우저에서 `http://localhost:3030` 접속
→ 사이드바 "🧪 실험실" > "💹 광고 기여도 분석" 클릭

---

## 📊 사용 방법

### 1단계: 광고비 입력

1. **"광고비 관리" 탭** 클릭
2. **"광고비 추가"** 버튼 클릭
3. 정보 입력:
   - **캠페인명**: UTM 캠페인명 (예: `winter_video_a`)
   - **소스** (선택): UTM 소스 (예: `facebook`)
   - **광고비**: 집행 비용 (예: `1500000`)
   - **메모** (선택): 설명 (예: "겨울신상 영상 광고")
4. **"저장"** 클릭

### 2단계: 분석 조건 설정

**"분석 조건"** 섹션에서:
- **시작일/종료일**: 분석 기간 선택
- **기여 기간**: 7일 또는 14일 (광고 클릭 후 몇 일까지 인정할지)
- **그룹화**: 
  - `캠페인별`: 같은 캠페인의 소스를 합산
  - `소스+캠페인별`: 소스별로 구분

### 3단계: 분석 실행

**"분석 실행"** 버튼 클릭

### 4단계: 결과 확인

#### 📈 기여 매출 순위 탭
- 각 광고의 기여 매출 확인
- 기여도 퍼센트 및 프로그레스 바
- 참여 주문 수

#### 💰 ROAS 분석 탭
- 광고비 대비 기여 매출 비율
- **ROAS 100% 이상**: 광고비보다 매출이 많음 (효율적)
- **ROAS 100% 미만**: 광고비보다 매출이 적음 (비효율적)

---

## 🔢 기여도 계산 방식

### Time Decay (시간 가중) 모델

```
구매일: 1월 10일
광고 접촉 이력:
- A 광고: 1월 9일 (1일 전)
- B 광고: 1월 5일 (5일 전)
- C 광고: 1월 1일 (9일 전)

시간 가중치 계산 (3일 반감기):
- A: 0.90 (최근)
- B: 0.40 (중간)
- C: 0.15 (오래전)

정규화 (100% 분배):
- A: 62.1%
- B: 27.6%
- C: 10.3%

구매 금액: 100,000원
기여 매출:
- A: 62,100원
- B: 27,600원
- C: 10,300원
```

### ROAS 계산

```
ROAS = (기여 매출 / 광고비) × 100

예시:
- A 광고비: 1,500,000원
- A 기여 매출: 3,200,000원
- A ROAS: (3,200,000 / 1,500,000) × 100 = 213%
```

---

## 💡 활용 팁

### 1. 기여 기간 선택
- **7일**: 빠른 전환 상품 (패션, 식품)
- **14일**: 고민 필요한 상품 (가전, 가구)

### 2. 그룹화 선택
- **캠페인별**: 전체 캠페인 성과 파악
- **소스+캠페인별**: 플랫폼별 효율 비교 (페이스북 vs 인스타그램)

### 3. 광고 최적화
- ROAS 100% 이상: 광고비 증액 고려
- ROAS 100% 미만: 광고 개선 또는 중단 고려
- 초기 접점 광고: 브랜드 인지도용
- 마지막 접점 광고: 전환 유도용

---

## 🔧 API 엔드포인트

### 기여도 분석
```http
GET /api/attribution/analyze?startDate=2025-01-01&endDate=2025-01-31&attributionWindow=7&groupBy=campaign
```

### 광고비 조회
```http
GET /api/attribution/ad-spend?groupBy=campaign
```

### 광고비 저장
```http
POST /api/attribution/ad-spend
Content-Type: application/json

{
  "utm_source": "facebook",
  "utm_campaign": "winter_video_a",
  "spend_amount": 1500000,
  "note": "겨울신상 영상 광고"
}
```

### 광고비 삭제
```http
DELETE /api/attribution/ad-spend/:id
```

---

## 📝 FAQ

### Q: 광고비를 입력하지 않으면?
A: 기여 매출은 확인할 수 있지만 ROAS는 계산되지 않습니다.

### Q: 같은 광고를 여러 번 클릭한 경우?
A: 가장 최근 클릭만 기여도 계산에 포함됩니다.

### Q: UTM이 없는 방문자는?
A: 기여도 분석에서 제외됩니다 (Direct, Organic 등).

### Q: 기여도 합계가 100%가 아닌 경우?
A: 여러 광고를 거친 경우 각 광고에 분배되므로, 개별 광고는 100% 미만입니다.

---

## 🐛 트러블슈팅

### "광고비 미입력" 표시
→ 광고비 관리 탭에서 해당 캠페인의 광고비 입력

### "분석 결과가 없습니다"
→ 선택한 기간에 구매 전환이 없거나 UTM 데이터가 없음

### ROAS가 매우 낮음
→ 광고비 대비 매출이 적음. 광고 개선 또는 타겟팅 재검토 필요

---

## 📞 문의

기술 문의: 개발팀
비즈니스 문의: 마케팅팀

