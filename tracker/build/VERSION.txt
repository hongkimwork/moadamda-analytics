v29.1 (v057)
Updated: 2026-02-11

🔑 방문자 식별 체계 강화 (브라우저 핑거프린트 + Cafe24 회원 ID)

NEW IN v29.1 (v057):
✅ 핑거프린트 localStorage 캐시 추가
  - MPA(카페24) 환경에서 페이지 이동 시 스크립트 재실행 → 핑거프린트 매번 null 문제 해결
  - 첫 페이지: 비동기 로드 후 localStorage에 저장
  - 두 번째 페이지부터: 캐시에서 즉시 읽어 모든 페이지뷰에 핑거프린트 포함

PREVIOUS v29.0 (v056):
✅ 브라우저 핑거프린트 수집 (FingerprintJS v5 CDN 비동기 로드)
  - CDN 실패 시 경량 fallback (canvas + screen + hardware 기반)
  - 공유 네트워크에서 다른 PC를 정확히 구별
  - 같은 브라우저에서 쿠키가 끊어진 경우 동일 방문자 복구
✅ Cafe24 회원 ID(member_id_crypt) 수집
  - 매 페이지뷰마다 common_member_id_crypt 수집
  - 다른 브라우저 간 동일 회원 연결 (인스타 인앱 → 사파리 교차 연결)
  - 로그인 회원만 해당 (전체 주문의 약 70%)
✅ 구매 이벤트에도 browser_fingerprint, member_id_crypt 포함

PREVIOUS v28.0 (v055):
✅ setCookie() 함수 개선
  - max-age 속성 추가 (expires보다 신뢰성 높음, 일부 모바일 브라우저 호환성 개선)
  - Secure 플래그 추가 (HTTPS 환경에서 보안 강화)
  - 발견된 문제: Android Chrome에서 0.07% 세션이 2시간 후 만료되지 않고 수개월 유지됨
  - 해결: expires + max-age 이중 설정으로 브라우저 호환성 극대화

PREVIOUS v27.0 (v054):
✅ 스크롤 뎁스 추적 개선 (모바일/PC 모든 환경 대응)
  - requestAnimationFrame 폴링 추가 (모멘텀 스크롤 중에도 위치 추적)
  - touchmove 이벤트 추가 (터치 스크롤 감지)
  - wheel 이벤트 추가 (PC 마우스 휠 감지)
  - scrollend 이벤트 추가 (지원 브라우저용, 스크롤 완료 시점 캡처)
  - 3단계 조합 방식: rAF 폴링(Primary) + 이벤트(Backup) + 이탈 시 캡처(Final)
  - 페이지 숨김 시 rAF 폴링 중지 (배터리 절약)

PREVIOUS v26.0 (v054):
✅ 빈 utm_content 복구 로직 추가
  - Meta 광고에서 일부 URL에 utm_content가 누락되어 전송되는 문제
  - utm_id를 기반으로 이전에 수집한 utm_content를 localStorage에 캐싱
  - 빈 utm_content가 들어오면 같은 utm_id의 캐시된 값으로 자동 복구
  - 캐시 크기 제한: 최대 50개 (오래된 것부터 삭제)

PREVIOUS v25.0 (v053):
✅ UTM 파라미터에서 + 문자를 공백으로 변환
  - URL 쿼리 스트링에서 +는 공백을 의미 (application/x-www-form-urlencoded)
  - decodeURIComponent는 +를 공백으로 변환하지 않음 (버그)
  - fullyDecode() 함수에서 디코딩 전 +를 공백으로 직접 변환
  - "77%+그립+다이어트" → "77% 그립 다이어트" 으로 올바르게 디코딩

PREVIOUS v24.0 (v052):
✅ UTM 파라미터 파싱 시 % 문자 인코딩 오류 처리
  - 메타 광고명에 "77% 할인" 같은 % 문자가 있으면 URL 디코딩 실패
  - fixMalformedPercent() 함수 추가: %XX 형식이 아닌 %를 %25로 치환
  - fullyDecode() 함수 개선: 디코딩 실패 시 추가 수정 시도
✅ 문제 해결: 광고 소재명이 빈 문자열로 저장되던 문제

PREVIOUS v23.0 (v051):
- 세션 타임아웃 60분 → 2시간 (카페24 애널리틱스 공식 기준)
- 방문자 쿠키 2년 → 1년 (카페24 순방문자 기준)
- 슬라이딩 윈도우 유지 (마지막 활동 기준)

PREVIOUS v22.0 (v050):
- 세션 타임아웃 2시간 → 60분 (카페24 애널리틱스 호환 시도)

PREVIOUS v21.0 (v049):
- 세션 타임아웃 30분 → 2시간 (카페24 접속통계 호환)

Previous features maintained:
- 스크롤 깊이 추적 (scroll_depth)
- 인앱 브라우저 감지 (FB/IG/카카오/네이버/라인)
- 인앱 브라우저 강화 전송 (sendBeacon + fetch 동시 사용)
- 실패 이벤트 sessionStorage 저장 및 재시도
- 쿠폰 선택 페이지 추적 (coupon_select)
- visibilitychange 이벤트
- checkout_attempt 이벤트
- heartbeat 기능 (30초 간격)
- 에러 로깅
- Dynamic UTM parameter collection
- Session end tracking
- DOM parsing fallback for order data
- UTM persistence via sessionStorage

DEPLOYMENT INFO:
- Backend: https://moadamda-analytics.co.kr/api/track
- Dashboard: https://marketingzon.com
- Server: Naver Cloud Platform
- SSL: Auto-renewal (Let's Encrypt)
