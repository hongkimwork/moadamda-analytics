# ë°ì´í„° ê²€ì¦ ë° í’ˆì§ˆ ê´€ë¦¬ ê·œì¹™

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-11-06
**ëª©ì **: í”„ë¡œë•ì…˜ ë°ì´í„°ì˜ ì •í™•ì„±ì„ ë³´ì¥í•˜ê³  ë¹„ì •ìƒ ê°’ ì¡°ê¸° ë°œê²¬

---

## ğŸš¨ í•µì‹¬ ì›ì¹™

### 1. ì ˆëŒ€ ì‹ ë¢°í•˜ì§€ ë§ ê²ƒ
- âŒ "ì´ ì¿¼ë¦¬ëŠ” ì˜ ì‘ë™í•  ê²ƒì´ë‹¤"
- âŒ "í”„ë¡ íŠ¸ì—”ë“œê°€ ë°›ì€ ë°ì´í„°ëŠ” ì •í™•í•  ê²ƒì´ë‹¤"
- âœ… "ëª¨ë“  ë°ì´í„°ëŠ” ê²€ì¦ë˜ì–´ì•¼ í•œë‹¤"
- âœ… "ê³„ì‚°ëœ ê°’ì€ í•©ë¦¬ì„± ì²´í¬ë¥¼ ê±°ì³ì•¼ í•œë‹¤"

### 2. ì‹¤ì œ ë°ì´í„°ë¡œ ê²€ì¦
- ìƒˆ API/ì¿¼ë¦¬ ê°œë°œ ì‹œ **ë°˜ë“œì‹œ í”„ë¡œë•ì…˜ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸**
- ê°€ìƒ ì‹œë‚˜ë¦¬ì˜¤ë§Œìœ¼ë¡œ ê°œë°œ ê¸ˆì§€
- ì‚¬ìš©ìì—ê²Œ í…ŒìŠ¤íŠ¸ ì¿¼ë¦¬ ì‹¤í–‰ ìš”ì²­

### 3. ë¹„ì •ìƒ ê°’ ê°ì§€
- ê³„ì‚°ëœ ê°’ì´ ë„ë©”ì¸ ìƒì‹ì— ë§ëŠ”ì§€ í™•ì¸
- ì„ê³„ê°’ ì„¤ì • ë° í•„í„°ë§
- ì´ìƒ ê°’ ë°œê²¬ ì‹œ ì¦‰ì‹œ ë³´ê³ 

---

## ğŸ“Š ë„ë©”ì¸ë³„ í•©ë¦¬ì„± ê¸°ì¤€

### ì›¹ ë¶„ì„ (moadamda-analytics)

#### ì²´ë¥˜ì‹œê°„ (Time Spent)
- **ì •ìƒ ë²”ìœ„**: 1ì´ˆ ~ 10ë¶„ (600ì´ˆ)
- **ì˜ì‹¬ ë²”ìœ„**: 10ë¶„ ~ 1ì‹œê°„ (3600ì´ˆ)
- **ë¹„ì •ìƒ**: 1ì‹œê°„ ì´ìƒ (3600ì´ˆ+)
- **ì¡°ì¹˜**: ë¹„ì •ìƒ ê°’ì€ í•„í„°ë§ ë˜ëŠ” ê²½ê³  í‘œì‹œ

```javascript
// âœ… ì˜¬ë°”ë¥¸ ì˜ˆì‹œ
const validPagePaths = page_path.filter(p => 
  p.time_spent_seconds > 0 && 
  p.time_spent_seconds <= 600  // 10ë¶„ ì œí•œ
);

// âŒ ì˜ëª»ëœ ì˜ˆì‹œ (ê²€ì¦ ì—†ìŒ)
const totalSeconds = page_path.reduce((sum, p) => sum + p.time_spent_seconds, 0);
```

#### ì„¸ì…˜ ì§€ì†ì‹œê°„
- **ì •ìƒ ë²”ìœ„**: 1ë¶„ ~ 30ë¶„
- **ì˜ì‹¬ ë²”ìœ„**: 30ë¶„ ~ 2ì‹œê°„
- **ë¹„ì •ìƒ**: 2ì‹œê°„ ì´ìƒ ë˜ëŠ” ì—¬ëŸ¬ ë‚  (ì¿ í‚¤ ë¬¸ì œ)

#### í˜ì´ì§€ë·° ìˆ˜
- **ì •ìƒ ë²”ìœ„**: 1 ~ 50 í˜ì´ì§€
- **ì˜ì‹¬ ë²”ìœ„**: 50 ~ 100 í˜ì´ì§€
- **ë¹„ì •ìƒ**: 100 í˜ì´ì§€ ì´ìƒ (ë´‡ ê°€ëŠ¥ì„±)

#### êµ¬ë§¤ ê¸ˆì•¡
- **ì •ìƒ ë²”ìœ„**: 10,000ì› ~ 500,000ì›
- **ì˜ì‹¬ ë²”ìœ„**: 1ì› ~ 10,000ì› (í…ŒìŠ¤íŠ¸ ì£¼ë¬¸)
- **ë¹„ì •ìƒ**: 0ì› ì´í•˜, 1,000,000ì› ì´ìƒ

---

## ğŸ”§ ê°œë°œ í”„ë¡œì„¸ìŠ¤ (í•„ìˆ˜)

### Phase 1: ë°ì´í„° íƒìƒ‰ ë° ì´í•´ (MUST)

**ìƒˆ ê¸°ëŠ¥ ê°œë°œ ì „ í•„ìˆ˜ ë‹¨ê³„:**

1. **ì‹¤ì œ ë°ì´í„° ìƒ˜í”Œ í™•ì¸**
```bash
# ì‚¬ìš©ìì—ê²Œ ìš”ì²­í•  ì¿¼ë¦¬
docker exec -i ma-postgres psql -U moadamda -d analytics -c "
  SELECT * FROM [í…Œì´ë¸”ëª…] 
  ORDER BY timestamp DESC 
  LIMIT 5;
"
```

2. **ë°ì´í„° ë²”ìœ„ í™•ì¸**
```bash
# MIN/MAX/AVG í™•ì¸
docker exec -i ma-postgres psql -U moadamda -d analytics -c "
  SELECT 
    MIN([ì»¬ëŸ¼]), MAX([ì»¬ëŸ¼]), AVG([ì»¬ëŸ¼]),
    COUNT(*), COUNT(DISTINCT [í‚¤])
  FROM [í…Œì´ë¸”ëª…];
"
```

3. **Edge Case í™•ì¸**
```bash
# ì´ìƒê°’ íƒìƒ‰
docker exec -i ma-postgres psql -U moadamda -d analytics -c "
  SELECT * FROM [í…Œì´ë¸”ëª…]
  WHERE [ì˜ì‹¬ ì¡°ê±´]
  LIMIT 10;
"
```

### Phase 2: ì¿¼ë¦¬ ì‘ì„± ë° ê²€ì¦

**SQL ì¿¼ë¦¬ ì‘ì„± ì‹œ:**

1. **WITH ì ˆë¡œ ë‹¨ê³„ë³„ ë¶„ë¦¬**
```sql
-- âœ… ì¢‹ì€ ì˜ˆì‹œ: ê° ë‹¨ê³„ ê²€ì¦ ê°€ëŠ¥
WITH step1 AS (
  SELECT ... -- ì²« ë²ˆì§¸ ë³€í™˜
),
step2 AS (
  SELECT ... FROM step1 -- ë‘ ë²ˆì§¸ ë³€í™˜
)
SELECT * FROM step2;

-- âŒ ë‚˜ìœ ì˜ˆì‹œ: í•œ ë²ˆì— ë³µì¡í•˜ê²Œ
SELECT ... FROM (
  SELECT ... FROM (
    SELECT ... -- ê²€ì¦ ë¶ˆê°€ëŠ¥
  )
);
```

2. **ìƒ˜í”Œ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸ (í•„ìˆ˜!)**
```bash
# ì‚¬ìš©ìì—ê²Œ ì¿¼ë¦¬ ì‹¤í–‰ ìš”ì²­
"ì´ ì¿¼ë¦¬ë¥¼ ì„œë²„ì—ì„œ ì‹¤í–‰í•´ì£¼ì„¸ìš”. ê²°ê³¼ë¥¼ í™•ì¸í•˜ê³  ë¡œì§ì´ ë§ëŠ”ì§€ ê²€ì¦í•˜ê² ìŠµë‹ˆë‹¤."
```

3. **ê²°ê³¼ í•©ë¦¬ì„± ê²€ì¦**
- ê³„ì‚°ëœ ê°’ì´ ë„ë©”ì¸ ê¸°ì¤€ì— ë§ëŠ”ê°€?
- NULLì´ ì˜ˆìƒì¹˜ ëª»í•œ ê³³ì— ìˆëŠ”ê°€?
- JOINìœ¼ë¡œ ì¸í•œ ì¤‘ë³µì´ ìˆëŠ”ê°€?

### Phase 3: í”„ë¡ íŠ¸ì—”ë“œ ê²€ì¦ ë¡œì§

**ëª¨ë“  ê³„ì‚°ëœ ê°’ì— ê²€ì¦ ì¶”ê°€:**

```javascript
// âœ… ì˜¬ë°”ë¥¸ ì˜ˆì‹œ
const totalSeconds = validPagePaths.reduce((sum, p) => sum + p.time_spent_seconds, 0);

// í•©ë¦¬ì„± ì²´í¬
if (totalSeconds > 3600) {
  console.warn(`ë¹„ì •ìƒì ìœ¼ë¡œ ê¸´ ì²´ë¥˜ì‹œê°„: ${totalSeconds}ì´ˆ`);
}

// ì•ˆì „í•œ í‘œì‹œ
const displaySeconds = Math.min(totalSeconds, 3600); // ìµœëŒ€ 1ì‹œê°„
```

**ë°ì´í„° ì†ŒìŠ¤ ì¼ê´€ì„± ì²´í¬:**

```javascript
// âœ… ì˜¬ë°”ë¥¸ ì˜ˆì‹œ: ë°ì´í„° ì†ŒìŠ¤ ëª…í™•íˆ
// utm_historyê°€ ìˆìœ¼ë©´ ìµœì‹  ì ‘ì´‰ ê¸°ì¤€ (Last-Touch)
const lastTouch = utm_history?.[utm_history.length - 1];
const utmDisplay = lastTouch?.utm_source || 'Direct';

// âŒ ì˜ëª»ëœ ì˜ˆì‹œ: ì—¬ëŸ¬ ì†ŒìŠ¤ í˜¼ì¬
const utmDisplay = order.utm_source || utm_history[0]?.utm_source; // í˜¼ë€
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ìƒˆ API ê°œë°œ ì‹œ (ë°±ì—”ë“œ)

- [ ] 1. í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ í™•ì¸ (`\d í…Œì´ë¸”ëª…`)
- [ ] 2. ìƒ˜í”Œ ë°ì´í„° 10ê±´ í™•ì¸ (ì‹¤ì œ ê°’ ë²”ìœ„ íŒŒì•…)
- [ ] 3. SQL ì¿¼ë¦¬ë¥¼ ë‹¨ê³„ë³„ë¡œ ì‹¤í–‰í•˜ì—¬ ì¤‘ê°„ ê²°ê³¼ ê²€ì¦
- [ ] 4. Edge Case ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸ (ë¹ˆ ê°’, NULL, ê·¹ë‹¨ê°’)
- [ ] 5. ê³„ì‚°ëœ ê°’ì˜ MIN/MAX/AVGê°€ í•©ë¦¬ì ì¸ì§€ í™•ì¸
- [ ] 6. JOINìœ¼ë¡œ ì¸í•œ ì¤‘ë³µ ë°œìƒ ì—¬ë¶€ í™•ì¸ (COUNT(*) vs COUNT(DISTINCT))

### ìƒˆ UI ê°œë°œ ì‹œ (í”„ë¡ íŠ¸ì—”ë“œ)

- [ ] 1. API ì‘ë‹µ êµ¬ì¡° í™•ì¸ (ì‹¤ì œ ë°ì´í„° ìƒ˜í”Œ)
- [ ] 2. ëª¨ë“  ê³„ì‚° ë¡œì§ì— í•©ë¦¬ì„± ì²´í¬ ì¶”ê°€
- [ ] 3. ë¹„ì •ìƒ ê°’ í•„í„°ë§ ë¡œì§ ì¶”ê°€
- [ ] 4. NULL/undefined ì•ˆì „ ì²˜ë¦¬ (optional chaining)
- [ ] 5. ë¸Œë¼ìš°ì € ê°œë°œìë„êµ¬ì—ì„œ ì‹¤ì œ ë°ì´í„° í™•ì¸
- [ ] 6. ì—¬ëŸ¬ ìƒ˜í”Œë¡œ í…ŒìŠ¤íŠ¸ (ì •ìƒ, Edge Case, ë¹„ì •ìƒ)

---

## ğŸš© ê²½ê³  ì‹ í˜¸ (Red Flags)

### ì¦‰ì‹œ ì¡°ì‚¬í•´ì•¼ í•  ìƒí™©

1. **ê³„ì‚° ê²°ê³¼ê°€ ë„ë©”ì¸ ìƒì‹ì— ë§ì§€ ì•ŠìŒ**
   - ì˜ˆ: ì²´ë¥˜ì‹œê°„ 22ì¼, êµ¬ë§¤ ê¸ˆì•¡ -100ì›
   - ì¡°ì¹˜: ì¦‰ì‹œ ë°ì´í„° ì›ë³¸ í™•ì¸, ê³„ì‚° ë¡œì§ ì¬ê²€í† 

2. **ê°™ì€ ë°ì´í„°ì˜ ë‹¤ë¥¸ ì†ŒìŠ¤ê°€ ë¶ˆì¼ì¹˜**
   - ì˜ˆ: order.utm_source â‰  utm_history[0].utm_source
   - ì¡°ì¹˜: ì–´ë–¤ ì†ŒìŠ¤ê°€ ì •í™•í•œì§€ í™•ì¸, ì¼ê´€ëœ ì†ŒìŠ¤ ì‚¬ìš©

3. **NULLì´ ì˜ˆìƒì¹˜ ëª»í•œ ê³³ì— ë‚˜íƒ€ë‚¨**
   - ì˜ˆ: í•„ìˆ˜ í•„ë“œê°€ NULL
   - ì¡°ì¹˜: ë°ì´í„° ìˆ˜ì§‘ ë¡œì§ ì ê²€

4. **COUNT(*)ê°€ ê¸°ëŒ€ë³´ë‹¤ í›¨ì”¬ í¼**
   - ì˜ˆ: ì£¼ë¬¸ 1ê±´ì¸ë° ê²°ê³¼ 100í–‰
   - ì¡°ì¹˜: JOINìœ¼ë¡œ ì¸í•œ ì¤‘ë³µ í™•ì¸

---

## ğŸ’» ì½”ë“œ íŒ¨í„´

### ë°±ì—”ë“œ (Node.js + PostgreSQL)

```javascript
// âœ… ì˜¬ë°”ë¥¸ ì¿¼ë¦¬ ì‘ì„±
const query = `
  WITH validated_data AS (
    SELECT 
      *,
      -- ë¹„ì •ìƒ ê°’ í•„í„°ë§
      CASE 
        WHEN time_spent > 3600 THEN NULL  -- 1ì‹œê°„ ì´ˆê³¼ ì œì™¸
        ELSE time_spent
      END as safe_time_spent
    FROM raw_data
    WHERE time_spent > 0  -- ìŒìˆ˜/0 ì œì™¸
  )
  SELECT 
    AVG(safe_time_spent) as avg_time,
    MAX(safe_time_spent) as max_time
  FROM validated_data
  WHERE safe_time_spent IS NOT NULL;
`;

// ê²°ê³¼ ê²€ì¦
const result = await db.query(query);
if (result.rows[0].max_time > 3600) {
  console.warn('ë¹„ì •ìƒ ê°’ ê°ì§€:', result.rows[0].max_time);
}
```

### í”„ë¡ íŠ¸ì—”ë“œ (React)

```javascript
// âœ… ì˜¬ë°”ë¥¸ ë°ì´í„° ì²˜ë¦¬
function OrderDetailPageContent({ orderId }) {
  const [data, setData] = useState(null);
  
  useEffect(() => {
    fetchOrderDetail().then(rawData => {
      // ë°ì´í„° ê²€ì¦ ë° ì •ì œ
      const validatedData = {
        ...rawData,
        page_path: rawData.page_path.filter(p => 
          p.time_spent_seconds > 0 && 
          p.time_spent_seconds <= 600  // 10ë¶„ ì œí•œ
        )
      };
      
      // í•©ë¦¬ì„± ì²´í¬
      const totalSeconds = validatedData.page_path.reduce(
        (sum, p) => sum + p.time_spent_seconds, 0
      );
      
      if (totalSeconds > 3600) {
        console.warn(`ë¹„ì •ìƒ ì²´ë¥˜ì‹œê°„: ${totalSeconds}ì´ˆ`);
      }
      
      setData(validatedData);
    });
  }, [orderId]);
  
  // ...
}
```

---

## ğŸ“š ì‹¤ì œ ì‚¬ë¡€: ì²´ë¥˜ì‹œê°„ ë²„ê·¸ (2025-11-06)

### ë¬¸ì œ
- í‘œì‹œëœ ì²´ë¥˜ì‹œê°„: 32,602ë¶„ = **22.6ì¼**
- ì‹¤ì œ ì²´ë¥˜ì‹œê°„: ìˆ˜ ë¶„

### ì›ì¸
1. ë°±ì—”ë“œ ì¿¼ë¦¬ê°€ 8ì¼ ê°„ê²©ì˜ ê°™ì€ URLì„ ë³‘í•©
2. MIN(timestamp) = 10/29, MAX(timestamp) = 11/6
3. í”„ë¡ íŠ¸ì—”ë“œê°€ ê²€ì¦ ì—†ì´ ê·¸ëŒ€ë¡œ í‘œì‹œ

### êµí›ˆ
- **í•©ë¦¬ì„± ì²´í¬ ë¶€ì¬**: 22ì¼ì„ ê·¸ëŒ€ë¡œ í‘œì‹œ
- **ì‹¤ì œ ë°ì´í„° í…ŒìŠ¤íŠ¸ ë¶€ì¬**: í”„ë¡œë•ì…˜ ë°ì´í„°ë¡œ ê²€ì¦ ì•ˆí•¨
- **ë„ë©”ì¸ ì§€ì‹ ë¯¸ì ìš©**: "ì²´ë¥˜ì‹œê°„ > 1ì‹œê°„ = ë¹„ì •ìƒ" ë¬´ì‹œ

### ë°©ì§€ì±…
1. âœ… ì²´ë¥˜ì‹œê°„ ì„ê³„ê°’ ì„¤ì • (10ë¶„)
2. âœ… í”„ë¡ íŠ¸ì—”ë“œ í•„í„°ë§ ì¶”ê°€
3. âœ… ë°±ì—”ë“œ ì„¸ì…˜ ê²€ì¦ ë¡œì§ ì¶”ê°€
4. âœ… ì‹ ê·œ APIëŠ” ë°˜ë“œì‹œ ì‹¤ì œ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸

---

## ğŸ¯ AI Agent ê°œë°œ ì‹œ íŠ¹ë³„ ì§€ì¹¨

### Agent ëª¨ë“œì˜ í•œê³„ ì¸ì •

1. **AIëŠ” ì‹¤ì œ ë°ì´í„°ë¥¼ ë³¼ ìˆ˜ ì—†ë‹¤**
   - ê°€ìƒ ì‹œë‚˜ë¦¬ì˜¤ë§Œìœ¼ë¡œ ì½”ë“œ ì‘ì„±
   - ë°˜ë“œì‹œ ì‚¬ìš©ìì—ê²Œ í…ŒìŠ¤íŠ¸ ì¿¼ë¦¬ ìš”ì²­

2. **ì‚¬ìš©ìì—ê²Œ ê²€ì¦ ìš”ì²­ (í•„ìˆ˜)**
```
"ì´ ì¿¼ë¦¬ë¥¼ ì„œë²„ì—ì„œ ì‹¤í–‰í•´ì£¼ì„¸ìš”:
[ì¿¼ë¦¬]

ê²°ê³¼ë¥¼ í™•ì¸í•˜ê³  ë‹¤ìŒì„ ê²€í† í•˜ê² ìŠµë‹ˆë‹¤:
- ê°’ì˜ ë²”ìœ„ê°€ í•©ë¦¬ì ì¸ê°€?
- NULLì´ ì˜ˆìƒì¹˜ ëª»í•œ ê³³ì— ìˆëŠ”ê°€?
- ì¤‘ë³µì´ ë°œìƒí–ˆëŠ”ê°€?"
```

3. **ë‹¨ê³„ì  ì ‘ê·¼ ê°•ì œ**
   - 1ë‹¨ê³„: ë°ì´í„° êµ¬ì¡° í™•ì¸
   - 2ë‹¨ê³„: ìƒ˜í”Œ ì¡°íšŒ
   - 3ë‹¨ê³„: ë¡œì§ ì‘ì„±
   - 4ë‹¨ê³„: ì‹¤ì œ ë°ì´í„°ë¡œ ê²€ì¦
   - 5ë‹¨ê³„: ë°°í¬

4. **ì‘ì—… ì¼ì‹œì •ì§€ ê·œì¹™ (ğŸš¨ ì ˆëŒ€ ê·œì¹™)**
   - ìƒˆ í…Œì´ë¸”/API ì‘ì—… ì‹œ â†’ ì¼ì‹œì •ì§€, ë°ì´í„° ìš”ì²­
   - ë³µì¡í•œ ê³„ì‚° ë¡œì§ ì‘ì„± ì‹œ â†’ ì¼ì‹œì •ì§€, ê²€ì¦ ìš”ì²­
   - ì´ìƒ ì§•í›„ ë°œê²¬ ì‹œ â†’ ì¼ì‹œì •ì§€, ì›ì¸ íŒŒì•…
   - **SQL ì¿¼ë¦¬ ì‘ì„±/ìˆ˜ì • ì‹œ â†’ ì¼ì‹œì •ì§€, ì‹¤ì œ ë°ì´í„°ë¡œ ê²€ì¦**
   - **ë°ì´í„° ì •ì œ/í•„í„°ë§ ë¡œì§ ì‘ì„± ì‹œ â†’ ì¼ì‹œì •ì§€, ìƒ˜í”Œ ë°ì´í„° ìš”ì²­**

---

## ğŸš¨ í•„ìˆ˜ ì‘ì—… ì¼ì‹œì •ì§€ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ìƒˆ API/ì¿¼ë¦¬ ê°œë°œ

**ìƒí™©:**
- ë°±ì—”ë“œ API ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€
- SQL ì¿¼ë¦¬ ì‘ì„±/ìˆ˜ì •
- ë°ì´í„° ì§‘ê³„/ê³„ì‚° ë¡œì§ ì¶”ê°€

**í–‰ë™:**
1. â¸ï¸ **ì‘ì—… ì¦‰ì‹œ ì¼ì‹œì •ì§€**
2. ğŸ“‹ ì‚¬ìš©ìì—ê²Œ ëª…ë ¹ì–´ ì œê³µ:
```bash
docker exec -i ma-postgres psql -U moadamda -d analytics -c "
  [ì‘ì„±í•œ ì¿¼ë¦¬ ë˜ëŠ” ìƒ˜í”Œ ì¿¼ë¦¬]
"
```
3. â³ ì‚¬ìš©ì ì‘ë‹µ ëŒ€ê¸°
4. âœ… ê²°ê³¼ ë¶„ì„ í›„ ì‘ì—… ì¬ê°œ

**ì˜ˆì‹œ:**
```
â¸ï¸ ì‘ì—… ì¼ì‹œì •ì§€

ìƒˆë¡œìš´ ì¿¼ë¦¬ë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤. ì‹¤ì œ ë°ì´í„°ë¡œ ê²€ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.

ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì„œë²„ì—ì„œ ì‹¤í–‰í•´ì£¼ì„¸ìš”:

docker exec -i ma-postgres psql -U moadamda -d analytics -c "
  SELECT page_url, timestamp, time_spent_seconds 
  FROM pageviews 
  WHERE session_id = (
    SELECT session_id FROM conversions 
    ORDER BY timestamp DESC LIMIT 1
  )
  ORDER BY timestamp ASC;
"

ê²°ê³¼ë¥¼ ë³´ë‚´ì£¼ì‹œë©´:
- time_spent_seconds ë²”ìœ„ í™•ì¸
- timestamp ìˆœì„œ í™•ì¸
- ì¤‘ë³µ ì—¬ë¶€ í™•ì¸
í›„ ì‘ì—…ì„ ê³„ì†í•˜ê² ìŠµë‹ˆë‹¤.
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì´ìƒ ê°’ ë°œê²¬

**ìƒí™©:**
- ê³„ì‚° ê²°ê³¼ê°€ ë„ë©”ì¸ ìƒì‹ì— ë§ì§€ ì•ŠìŒ
- 32,602ë¶„, -100ì›, NULLì´ ì˜ˆìƒì¹˜ ëª»í•œ ê³³ì— ë“±ì¥

**í–‰ë™:**
1. â¸ï¸ **ì‘ì—… ì¦‰ì‹œ ì¼ì‹œì •ì§€**
2. ğŸ” ì›ì¸ íŒŒì•…ì„ ìœ„í•œ ì¿¼ë¦¬ ì œê³µ
3. â³ ì‚¬ìš©ì ì‘ë‹µ ëŒ€ê¸°
4. ğŸ¯ ê·¼ë³¸ ì›ì¸ íŒŒì•… í›„ í•´ê²°

**ì˜ˆì‹œ:**
```
â¸ï¸ ì‘ì—… ì¼ì‹œì •ì§€

ë¹„ì •ìƒ ê°’ ë°œê²¬: ì²´ë¥˜ì‹œê°„ 32,602ë¶„ (22.6ì¼)

ì›ì¸ íŒŒì•…ì„ ìœ„í•´ ë‹¤ìŒ ëª…ë ¹ì–´ë“¤ì„ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰í•´ì£¼ì„¸ìš”:

1. í•´ë‹¹ ì£¼ë¬¸ì˜ ê¸°ë³¸ ì •ë³´:
docker exec -i ma-postgres psql -U moadamda -d analytics -c "
  SELECT order_id, timestamp, visitor_id, session_id 
  FROM conversions 
  WHERE order_id = '20251106-0000108';
"

2. í•´ë‹¹ ì„¸ì…˜ì˜ ëª¨ë“  pageview:
docker exec -i ma-postgres psql -U moadamda -d analytics -c "
  SELECT page_url, timestamp 
  FROM pageviews 
  WHERE session_id = '[1ë²ˆ ê²°ê³¼ì˜ session_id]'
  ORDER BY timestamp ASC;
"

3. ì²´ë¥˜ì‹œê°„ ê³„ì‚° ë¡œì§ í…ŒìŠ¤íŠ¸:
docker exec -i ma-postgres psql -U moadamda -d analytics -c "
  [ì²´ë¥˜ì‹œê°„ ê³„ì‚° ì¿¼ë¦¬]
"

ê²°ê³¼ë¥¼ ëª¨ë‘ ë³´ë‚´ì£¼ì‹œë©´ ì›ì¸ì„ ì •í™•íˆ íŒŒì•…í•˜ê² ìŠµë‹ˆë‹¤.
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 3: ë°ì´í„° ì†ŒìŠ¤ ë¶ˆì¼ì¹˜

**ìƒí™©:**
- ê°™ì€ ì •ë³´ì˜ ì—¬ëŸ¬ ì†ŒìŠ¤ê°€ ë‹¤ë¥¸ ê°’ í‘œì‹œ
- order.utm_source â‰  utm_history[0].utm_source

**í–‰ë™:**
1. â¸ï¸ **ì‘ì—… ì¦‰ì‹œ ì¼ì‹œì •ì§€**
2. ğŸ” ê° ì†ŒìŠ¤ì˜ ë°ì´í„° í™•ì¸ ì¿¼ë¦¬ ì œê³µ
3. â³ ì‚¬ìš©ì ì‘ë‹µ ëŒ€ê¸°
4. âœ… ì •í™•í•œ ì†ŒìŠ¤ ì„ íƒ í›„ ì‘ì—… ì¬ê°œ

**ì˜ˆì‹œ:**
```
â¸ï¸ ì‘ì—… ì¼ì‹œì •ì§€

UTM ë°ì´í„° ë¶ˆì¼ì¹˜ ë°œê²¬:
- order.utm_source: null
- utm_history: kakao

ì–´ë–¤ ê²ƒì´ ì •í™•í•œì§€ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.

ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ì£¼ì„¸ìš”:

1. visitors í…Œì´ë¸” UTM (ìµœì´ˆ ë°©ë¬¸):
docker exec -i ma-postgres psql -U moadamda -d analytics -c "
  SELECT utm_source, utm_medium, first_visit 
  FROM visitors 
  WHERE visitor_id = '[visitor_id]';
"

2. utm_sessions í…Œì´ë¸” UTM (ì „ì²´ ì ‘ì´‰):
docker exec -i ma-postgres psql -U moadamda -d analytics -c "
  SELECT utm_source, utm_medium, entry_timestamp 
  FROM utm_sessions 
  WHERE visitor_id = '[visitor_id]'
  ORDER BY entry_timestamp ASC;
"

3. ì£¼ë¬¸ ì‹œê°„:
docker exec -i ma-postgres psql -U moadamda -d analytics -c "
  SELECT timestamp 
  FROM conversions 
  WHERE order_id = '[order_id]';
"

ê²°ê³¼ë¥¼ ë³´ë‚´ì£¼ì‹œë©´ ì–´ë–¤ UTMì´ êµ¬ë§¤ì— ì˜í–¥ì„ ì£¼ì—ˆëŠ”ì§€ íŒë‹¨í•˜ê² ìŠµë‹ˆë‹¤.
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 4: í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ë¶ˆí™•ì‹¤

**ìƒí™©:**
- ì»¬ëŸ¼ëª…ì´ ë¶ˆí™•ì‹¤
- ë°ì´í„° íƒ€ì…ì´ ë¶ˆí™•ì‹¤ (JSONB vs ì¼ë°˜ ì»¬ëŸ¼)

**í–‰ë™:**
1. â¸ï¸ **ì‘ì—… ì¦‰ì‹œ ì¼ì‹œì •ì§€**
2. ğŸ“‹ ìŠ¤í‚¤ë§ˆ í™•ì¸ ëª…ë ¹ì–´ ì œê³µ
3. â³ ì‚¬ìš©ì ì‘ë‹µ ëŒ€ê¸°
4. âœ… ì •í™•í•œ ì»¬ëŸ¼ëª… í™•ì¸ í›„ ì‘ì—… ì¬ê°œ

**ì˜ˆì‹œ:**
```
â¸ï¸ ì‘ì—… ì¼ì‹œì •ì§€

events í…Œì´ë¸”ì˜ ì •í™•í•œ ìŠ¤í‚¤ë§ˆ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.

ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ì£¼ì„¸ìš”:

docker exec -i ma-postgres psql -U moadamda -d analytics -c "\d events"

ê²°ê³¼ë¥¼ ë³´ë‚´ì£¼ì‹œë©´:
- ì»¬ëŸ¼ëª… í™•ì¸
- ë°ì´í„° íƒ€ì… í™•ì¸
- metadata JSONB êµ¬ì¡° í™•ì¸
í›„ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.
```

---

## ğŸ“ ì‘ì—… ì¼ì‹œì •ì§€ í…œí”Œë¦¿

### ê¸°ë³¸ í…œí”Œë¦¿
```
â¸ï¸ ì‘ì—… ì¼ì‹œì •ì§€ - [ì´ìœ ]

[ìƒí™© ì„¤ëª…]

ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì„œë²„ì—ì„œ ì‹¤í–‰í•´ì£¼ì„¸ìš”:

```bash
[ëª…ë ¹ì–´]
```

[ê¸°ëŒ€í•˜ëŠ” ê²°ê³¼ ì„¤ëª…]

ê²°ê³¼ë¥¼ ë³´ë‚´ì£¼ì‹œë©´ [ë‹¤ìŒ ë‹¨ê³„] í•˜ê² ìŠµë‹ˆë‹¤.
```

### ë³µìˆ˜ ì¿¼ë¦¬ í…œí”Œë¦¿
```
â¸ï¸ ì‘ì—… ì¼ì‹œì •ì§€ - ë°ì´í„° ê²€ì¦ í•„ìš”

[ìƒí™© ì„¤ëª…]

ë‹¤ìŒ ëª…ë ¹ì–´ë“¤ì„ **ìˆœì„œëŒ€ë¡œ** ì‹¤í–‰í•´ì£¼ì„¸ìš”:

### ëª…ë ¹ì–´ 1: [ëª©ì ]
```bash
[ëª…ë ¹ì–´ 1]
```

### ëª…ë ¹ì–´ 2: [ëª©ì ]
```bash
[ëª…ë ¹ì–´ 2]
```

### ëª…ë ¹ì–´ 3: [ëª©ì ]
```bash
[ëª…ë ¹ì–´ 3]
```

ëª¨ë“  ê²°ê³¼ë¥¼ ë³´ë‚´ì£¼ì‹œë©´ ì¢…í•© ë¶„ì„ í›„ ì‘ì—…ì„ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤.
```

---

## ğŸ“ ì‹¤ì œ ì‚¬ë¡€: ì²´ë¥˜ì‹œê°„ ë²„ê·¸ (2025-11-06)

### ì˜¬ë°”ë¥¸ ì§„í–‰ ë°©ì‹ (ê°œì„  í›„)

1. **ë¬¸ì œ ì¸ì§€**: 32,602ë¶„ = ë¹„ì •ìƒ ê°’
2. â¸ï¸ **ì¦‰ì‹œ ì¼ì‹œì •ì§€**
3. ğŸ“‹ **ì¿¼ë¦¬ ì œê³µ**:
```bash
# 1. ê¸°ë³¸ ì •ë³´
docker exec -i ma-postgres psql -U moadamda -d analytics -c "..."

# 2. í˜ì´ì§€ë·° í™•ì¸
docker exec -i ma-postgres psql -U moadamda -d analytics -c "..."

# 3. ê³„ì‚° ë¡œì§ í…ŒìŠ¤íŠ¸
docker exec -i ma-postgres psql -U moadamda -d analytics -c "..."
```
4. â³ **ì‚¬ìš©ì ì‘ë‹µ ëŒ€ê¸°**
5. âœ… **ì›ì¸ íŒŒì•…**: 8ì¼ ê°„ê²© URL ë³‘í•©
6. ğŸ”§ **ê·¼ë³¸ í•´ê²°**: ì¤‘ë³µ ì œê±° ë¡œì§ ì œê±°

### ì˜ëª»ëœ ì§„í–‰ ë°©ì‹ (ê°œì„  ì „)

1. ë¬¸ì œ ì¸ì§€: 32,602ë¶„ = ë¹„ì •ìƒ ê°’
2. âŒ **ê°€ì •ìœ¼ë¡œ ìˆ˜ì •**: "ì•„ë§ˆ í•„í„°ë§ì´ í•„ìš”í•  ê±°ì•¼"
3. âŒ **í”„ë¡ íŠ¸ì—”ë“œ ì„ì‹œë°©í¸**: filter ì¶”ê°€
4. âŒ **ê·¼ë³¸ ì›ì¸ ë¯¸íŒŒì•…**: ë°±ì—”ë“œ ì¿¼ë¦¬ ë¬¸ì œ ë°©ì¹˜

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸ (ëª¨ë“  ê°œë°œ ì‹œ í•„ìˆ˜)

### ê°œë°œ ì‹œì‘ ì „
- [ ] ê´€ë ¨ í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ í™•ì¸
- [ ] ìƒ˜í”Œ ë°ì´í„° 10ê±´ ì´ìƒ í™•ì¸
- [ ] ë°ì´í„° ë²”ìœ„ (MIN/MAX/AVG) í™•ì¸
- [ ] Edge Case íŒŒì•…

### ê°œë°œ ì¤‘
- [ ] SQL ì¿¼ë¦¬ ë‹¨ê³„ë³„ í…ŒìŠ¤íŠ¸
- [ ] ì¤‘ê°„ ê²°ê³¼ í•©ë¦¬ì„± í™•ì¸
- [ ] NULL ì²˜ë¦¬ ëª…ì‹œì ìœ¼ë¡œ ì‘ì„±
- [ ] ê²€ì¦ ë¡œì§ ì¶”ê°€ (ì„ê³„ê°’, í•„í„°ë§)

### ë°°í¬ ì „
- [ ] ì‹¤ì œ í”„ë¡œë•ì…˜ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸
- [ ] ì—¬ëŸ¬ ìƒ˜í”Œë¡œ ê²€ì¦ (ì •ìƒ, Edge, ë¹„ì •ìƒ)
- [ ] ë¸Œë¼ìš°ì € ê°œë°œìë„êµ¬ì—ì„œ í™•ì¸
- [ ] ê³„ì‚°ëœ ê°’ì´ ë„ë©”ì¸ ê¸°ì¤€ì— ë§ëŠ”ì§€ ìµœì¢… í™•ì¸

---

**í•µì‹¬ ì›ì¹™:**
> "ì‹ ë¢°í•˜ì§€ ë§ê³  ê²€ì¦í•˜ë¼ (Trust Nothing, Verify Everything)"
> "ì‹¤ì œ ë°ì´í„°ê°€ ì§„ì‹¤ì„ ë§í•œë‹¤"
> "ë¹„ì •ìƒ ê°’ì€ ë²„ê·¸ì˜ ì‹ í˜¸ë‹¤"
