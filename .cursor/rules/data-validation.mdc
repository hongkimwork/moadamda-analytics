---
alwaysApply: false
applyIntelligently: true
description: ë°ì´í„° ê²€ì¦ - SQL/API ìž‘ì—… ì‹œ AI ìžë™ ê²€ì¦
---

# ë°ì´í„° ê²€ì¦ (AI ìžë™ ì‹¤í–‰)

**ì—…ë°ì´íŠ¸**: 2025-11-17  
**ëª©ì **: AIê°€ ìžë™ìœ¼ë¡œ ì„œë²„ ì ‘ì†í•˜ì—¬ ë°ì´í„° ê²€ì¦

---

## ðŸ¤– AI ìžë™ ê²€ì¦ íŠ¸ë¦¬ê±°

### ìžë™ ì°¸ì¡° ì‹œë‚˜ë¦¬ì˜¤
1. **SQL ì¿¼ë¦¬ ìž‘ì„± ì‹œ** â†’ ìžë™ìœ¼ë¡œ ì„œë²„ì—ì„œ ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸
2. **ìƒˆ API ê°œë°œ ì‹œ** â†’ ì‹¤ì œ ë°ì´í„° ë²”ìœ„ í™•ì¸
3. **ë°°í¬ í›„** (@deploy.mdc) â†’ API ìƒíƒœ ì²´í¬
4. **ë¹„ì •ìƒ ê°’ ë°œê²¬ ì‹œ** â†’ ì›ì¸ íŒŒì•… ì¿¼ë¦¬ ìžë™ ì‹¤í–‰

### AI ìžë™ ì‹¤í–‰ ë°©ë²•
```bash
# AIê°€ ìžë™ìœ¼ë¡œ SSH ì ‘ì†í•˜ì—¬ ì‹¤í–‰
ssh root@49.50.139.223 'docker exec ma-postgres psql -U moadamda -d analytics -c "..."'
```

**ê²°ê³¼:**
- ì‚¬ìš©ìžëŠ” ëª…ë ¹ì–´ ìž…ë ¥ ë¶ˆí•„ìš”
- AIê°€ ì§ì ‘ ê²€ì¦ í›„ ë³´ê³ 

---

## ðŸš¨ í•µì‹¬ ì›ì¹™

1. **Trust Nothing** - ëª¨ë“  ë°ì´í„° ê²€ì¦ í•„ìˆ˜
2. **AI ìžë™ ê²€ì¦** - ì„œë²„ ì ‘ì†í•˜ì—¬ ì‹¤ì œ ë°ì´í„° í™•ì¸
3. **ë¹„ì •ìƒ ê°’ í•„í„°ë§** - ìž„ê³„ê°’ ì´ˆê³¼ ì‹œ ìžë™ í•„í„°ë§

---

## ðŸ“Š ë„ë©”ì¸ë³„ ìž„ê³„ê°’ (moadamda-analytics)

### ì²´ë¥˜ì‹œê°„ (Time Spent)
```
âœ… ì •ìƒ: 1ì´ˆ ~ 10ë¶„ (600ì´ˆ)
âš ï¸ ì˜ì‹¬: 10ë¶„ ~ 1ì‹œê°„ (3600ì´ˆ)
âŒ ë¹„ì •ìƒ: 1ì‹œê°„ ì´ìƒ â†’ í•„í„°ë§ í•„ìˆ˜
```

### ì„¸ì…˜ ì§€ì†ì‹œê°„
```
âœ… ì •ìƒ: 1ë¶„ ~ 30ë¶„
âš ï¸ ì˜ì‹¬: 30ë¶„ ~ 2ì‹œê°„
âŒ ë¹„ì •ìƒ: 2ì‹œê°„ ì´ìƒ (ì¿ í‚¤ ë¬¸ì œ ê°€ëŠ¥ì„±)
```

### íŽ˜ì´ì§€ë·° ìˆ˜
```
âœ… ì •ìƒ: 1 ~ 50 íŽ˜ì´ì§€
âš ï¸ ì˜ì‹¬: 50 ~ 100 íŽ˜ì´ì§€
âŒ ë¹„ì •ìƒ: 100 íŽ˜ì´ì§€ ì´ìƒ (ë´‡ ê°€ëŠ¥ì„±)
```

### êµ¬ë§¤ ê¸ˆì•¡
```
âœ… ì •ìƒ: 10,000ì› ~ 500,000ì›
âš ï¸ ì˜ì‹¬: 1ì› ~ 10,000ì› (í…ŒìŠ¤íŠ¸ ì£¼ë¬¸)
âŒ ë¹„ì •ìƒ: 0ì› ì´í•˜, 1,000,000ì› ì´ìƒ
```

---

## ðŸ”§ AI ìžë™ ê²€ì¦ í”„ë¡œì„¸ìŠ¤

### Phase 1: ë°ì´í„° íƒìƒ‰ (AI ìžë™ ì‹¤í–‰)

**AIê°€ ìžë™ìœ¼ë¡œ ì‹¤í–‰:**

```bash
# AI ë‚´ë¶€ ë™ìž‘
ssh root@49.50.139.223 '
  docker exec ma-postgres psql -U moadamda -d analytics -c "
    SELECT * FROM [í…Œì´ë¸”ëª…] ORDER BY timestamp DESC LIMIT 5;
    SELECT MIN([ì»¬ëŸ¼]), MAX([ì»¬ëŸ¼]), AVG([ì»¬ëŸ¼]) FROM [í…Œì´ë¸”ëª…];
  "
'
```

**ì‚¬ìš©ìžì—ê²Œ ë³´ê³ :**
```
âœ… ë°ì´í„° ê²€ì¦ ì™„ë£Œ
- ìƒ˜í”Œ: 5ê±´ í™•ì¸
- ë²”ìœ„: ì •ìƒ (1ì´ˆ~600ì´ˆ)
- ë¹„ì •ìƒ: 3ê±´ ë°œê²¬ â†’ í•„í„°ë§ ì¶”ê°€
```

### Phase 2: ì¿¼ë¦¬ ìž‘ì„± ë° í…ŒìŠ¤íŠ¸

**ë‹¨ê³„ë³„ ê²€ì¦:**

```sql
-- âœ… ì¢‹ì€ ì˜ˆ: WITH ì ˆë¡œ ë‹¨ê³„ ë¶„ë¦¬
WITH step1 AS (
  SELECT ... -- ì²« ë²ˆì§¸ ë³€í™˜
),
step2 AS (
  SELECT ... FROM step1 -- ë‘ ë²ˆì§¸ ë³€í™˜
)
SELECT * FROM step2;

-- âŒ ë‚˜ìœ ì˜ˆ: í•œ ë²ˆì— ë³µìž¡í•˜ê²Œ (ê²€ì¦ ë¶ˆê°€)
SELECT ... FROM (
  SELECT ... FROM (SELECT ...)
);
```

**ê²€ì¦ í•­ëª©:**
- ê³„ì‚°ëœ ê°’ì´ ë„ë©”ì¸ ê¸°ì¤€ì— ë§žëŠ”ê°€?
- NULLì´ ì˜ˆìƒì¹˜ ëª»í•œ ê³³ì— ìžˆëŠ”ê°€?
- JOINìœ¼ë¡œ ì¸í•œ ì¤‘ë³µì´ ìžˆëŠ”ê°€?

### Phase 3: í”„ë¡ íŠ¸ì—”ë“œ ê²€ì¦ ë¡œì§

**ëª¨ë“  ê³„ì‚°ê°’ì— ê²€ì¦ ì¶”ê°€:**

```javascript
// âœ… ì˜¬ë°”ë¥¸ ì˜ˆì‹œ
const totalSeconds = validPagePaths.reduce(
  (sum, p) => sum + p.time_spent_seconds, 0
);

// í•©ë¦¬ì„± ì²´í¬
if (totalSeconds > 3600) {
  console.warn(`ë¹„ì •ìƒì ìœ¼ë¡œ ê¸´ ì²´ë¥˜ì‹œê°„: ${totalSeconds}ì´ˆ`);
}

// ì•ˆì „í•œ í‘œì‹œ
const displaySeconds = Math.min(totalSeconds, 3600); // ìµœëŒ€ 1ì‹œê°„
```

---

## ðŸš© ê²½ê³  ì‹ í˜¸ (Red Flags)

### ì¦‰ì‹œ ì¡°ì‚¬í•´ì•¼ í•  ìƒí™©

#### 1. ê³„ì‚° ê²°ê³¼ê°€ ë„ë©”ì¸ ìƒì‹ì— ë§žì§€ ì•ŠìŒ
- ì˜ˆ: ì²´ë¥˜ì‹œê°„ 22ì¼, êµ¬ë§¤ ê¸ˆì•¡ -100ì›
- **ì¡°ì¹˜**: â¸ï¸ ìž‘ì—… ì¼ì‹œì •ì§€ â†’ ë°ì´í„° ì›ë³¸ í™•ì¸ â†’ ê³„ì‚° ë¡œì§ ìž¬ê²€í† 

#### 2. ê°™ì€ ë°ì´í„°ì˜ ë‹¤ë¥¸ ì†ŒìŠ¤ê°€ ë¶ˆì¼ì¹˜
- ì˜ˆ: `order.utm_source â‰  utm_history[0].utm_source`
- **ì¡°ì¹˜**: ì–´ë–¤ ì†ŒìŠ¤ê°€ ì •í™•í•œì§€ í™•ì¸, ì¼ê´€ëœ ì†ŒìŠ¤ ì‚¬ìš©

#### 3. NULLì´ ì˜ˆìƒì¹˜ ëª»í•œ ê³³ì— ë‚˜íƒ€ë‚¨
- ì˜ˆ: í•„ìˆ˜ í•„ë“œê°€ NULL
- **ì¡°ì¹˜**: ë°ì´í„° ìˆ˜ì§‘ ë¡œì§ ì ê²€

#### 4. COUNT(*)ê°€ ê¸°ëŒ€ë³´ë‹¤ í›¨ì”¬ í¼
- ì˜ˆ: ì£¼ë¬¸ 1ê±´ì¸ë° ê²°ê³¼ 100í–‰
- **ì¡°ì¹˜**: JOINìœ¼ë¡œ ì¸í•œ ì¤‘ë³µ í™•ì¸

---

## ðŸ’» ì½”ë“œ íŒ¨í„´

### ë°±ì—”ë“œ (ê²€ì¦ ë¡œì§ í¬í•¨)

```javascript
const query = `
  WITH validated_data AS (
    SELECT 
      *,
      -- ë¹„ì •ìƒ ê°’ í•„í„°ë§
      CASE 
        WHEN time_spent > 3600 THEN NULL  -- 1ì‹œê°„ ì´ˆê³¼ ì œì™¸
        ELSE time_spent
      END as safe_time_spent
    FROM raw_data
    WHERE time_spent > 0  -- ìŒìˆ˜/0 ì œì™¸
  )
  SELECT 
    AVG(safe_time_spent) as avg_time,
    MAX(safe_time_spent) as max_time
  FROM validated_data
  WHERE safe_time_spent IS NOT NULL;
`;

// ê²°ê³¼ ê²€ì¦
const result = await db.query(query);
if (result.rows[0].max_time > 3600) {
  console.warn('ë¹„ì •ìƒ ê°’ ê°ì§€:', result.rows[0].max_time);
}
```

### í”„ë¡ íŠ¸ì—”ë“œ (ë°ì´í„° í•„í„°ë§)

```javascript
function OrderDetailPageContent({ orderId }) {
  const [data, setData] = useState(null);
  
  useEffect(() => {
    fetchOrderDetail().then(rawData => {
      // ë°ì´í„° ê²€ì¦ ë° ì •ì œ
      const validatedData = {
        ...rawData,
        page_path: rawData.page_path.filter(p => 
          p.time_spent_seconds > 0 && 
          p.time_spent_seconds <= 600  // 10ë¶„ ì œí•œ
        )
      };
      
      setData(validatedData);
    });
  }, [orderId]);
  
  // ...
}
```

---

## ðŸ“š ì‹¤ì œ ì‚¬ë¡€: ì²´ë¥˜ì‹œê°„ ë²„ê·¸ (2025-11-06)

### ë¬¸ì œ
- **í‘œì‹œëœ ê°’**: 32,602ë¶„ = 22.6ì¼
- **ì‹¤ì œ ê°’**: ìˆ˜ ë¶„

### ì›ì¸
1. ë°±ì—”ë“œ ì¿¼ë¦¬ê°€ 8ì¼ ê°„ê²©ì˜ ê°™ì€ URLì„ ë³‘í•©
2. `MIN(timestamp) = 10/29`, `MAX(timestamp) = 11/6`
3. í”„ë¡ íŠ¸ì—”ë“œê°€ ê²€ì¦ ì—†ì´ ê·¸ëŒ€ë¡œ í‘œì‹œ

### êµí›ˆ
- âŒ í•©ë¦¬ì„± ì²´í¬ ë¶€ìž¬
- âŒ ì‹¤ì œ ë°ì´í„° í…ŒìŠ¤íŠ¸ ë¶€ìž¬
- âŒ ë„ë©”ì¸ ì§€ì‹ ë¯¸ì ìš©

### í•´ê²°ì±…
- âœ… ì²´ë¥˜ì‹œê°„ ìž„ê³„ê°’ ì„¤ì • (10ë¶„)
- âœ… í”„ë¡ íŠ¸ì—”ë“œ í•„í„°ë§ ì¶”ê°€
- âœ… ë°±ì—”ë“œ ì„¸ì…˜ ê²€ì¦ ë¡œì§ ì¶”ê°€

---

## ðŸŽ¯ AI Agent ìž‘ì—… ê·œì¹™

### í•„ìˆ˜ ìž‘ì—… ì¼ì‹œì •ì§€ ì‹œë‚˜ë¦¬ì˜¤

#### 1. ìƒˆ API/ì¿¼ë¦¬ ê°œë°œ ì‹œ
â¸ï¸ **ìž‘ì—… ì¦‰ì‹œ ì¼ì‹œì •ì§€** â†’ ì‚¬ìš©ìžì—ê²Œ í…ŒìŠ¤íŠ¸ ì¿¼ë¦¬ ì œê³µ â†’ ê²°ê³¼ í™•ì¸ â†’ ìž¬ê°œ

```
â¸ï¸ ìž‘ì—… ì¼ì‹œì •ì§€ - ë°ì´í„° ê²€ì¦ í•„ìš”

ìƒˆë¡œìš´ ì¿¼ë¦¬ë¥¼ ìž‘ì„±í–ˆìŠµë‹ˆë‹¤. ì‹¤ì œ ë°ì´í„°ë¡œ ê²€ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.

ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì„œë²„ì—ì„œ ì‹¤í–‰í•´ì£¼ì„¸ìš”:

docker exec -i ma-postgres psql -U moadamda -d analytics -c "
  [ìž‘ì„±í•œ ì¿¼ë¦¬]
"

ê²°ê³¼ë¥¼ ë³´ë‚´ì£¼ì‹œë©´ ê²€ì¦ í›„ ìž‘ì—…ì„ ê³„ì†í•˜ê² ìŠµë‹ˆë‹¤.
```

#### 2. ë¹„ì •ìƒ ê°’ ë°œê²¬ ì‹œ
â¸ï¸ **ìž‘ì—… ì¦‰ì‹œ ì¼ì‹œì •ì§€** â†’ ì›ì¸ íŒŒì•… ì¿¼ë¦¬ ì œê³µ â†’ ê·¼ë³¸ í•´ê²°

#### 3. í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ë¶ˆí™•ì‹¤ ì‹œ
â¸ï¸ **ìž‘ì—… ì¦‰ì‹œ ì¼ì‹œì •ì§€** â†’ ìŠ¤í‚¤ë§ˆ í™•ì¸ ìš”ì²­ â†’ ìž¬ê°œ

```bash
docker exec -i ma-postgres psql -U moadamda -d analytics -c "\d [í…Œì´ë¸”ëª…]"
```

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸ (ëª¨ë“  ê°œë°œ ì‹œ í•„ìˆ˜)

### ê°œë°œ ì‹œìž‘ ì „
- [ ] ê´€ë ¨ í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ í™•ì¸
- [ ] ìƒ˜í”Œ ë°ì´í„° 10ê±´ ì´ìƒ í™•ì¸
- [ ] ë°ì´í„° ë²”ìœ„ (MIN/MAX/AVG) í™•ì¸

### ê°œë°œ ì¤‘
- [ ] SQL ì¿¼ë¦¬ ë‹¨ê³„ë³„ í…ŒìŠ¤íŠ¸
- [ ] ì¤‘ê°„ ê²°ê³¼ í•©ë¦¬ì„± í™•ì¸
- [ ] ê²€ì¦ ë¡œì§ ì¶”ê°€ (ìž„ê³„ê°’, í•„í„°ë§)

### ë°°í¬ ì „
- [ ] ì‹¤ì œ í”„ë¡œë•ì…˜ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸
- [ ] ì—¬ëŸ¬ ìƒ˜í”Œë¡œ ê²€ì¦ (ì •ìƒ, Edge, ë¹„ì •ìƒ)
- [ ] ê³„ì‚°ëœ ê°’ì´ ë„ë©”ì¸ ê¸°ì¤€ì— ë§žëŠ”ì§€ ìµœì¢… í™•ì¸

---

**í•µì‹¬ ì›ì¹™**: "ì‹ ë¢°í•˜ì§€ ë§ê³  ê²€ì¦í•˜ë¼ (Trust Nothing, Verify Everything)"
